<!-- Sticky CTA -->
<aside id="sticky-cta" class="fixed bottom-0 left-0 right-0 z-50 transition-transform duration-500 ease-out overflow-hidden" style="box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3); background-color: #1e293b; background-image: url('/assets/images/sticky-cta-bg.png'); background-position: center; background-size: cover; background-repeat: no-repeat; width: 100vw;" aria-label="Call to action" data-sticky-cta>
    <!-- Close button -->
    <button type="button" class="absolute top-2 right-2 md:right-4 p-2 text-white/60 hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-white/50 rounded z-20" aria-label="Dismiss" data-dismiss-cta>
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
    </button>

    <!-- Content -->
    <div class="relative z-10 max-w-7xl mx-auto px-4 md:px-6 py-4 md:py-5">
        <div class="flex flex-col md:flex-row md:items-center gap-3 md:gap-6 pr-8 md:pr-0">
            <div class="flex-1 text-white">
                <h3 class="text-lg md:text-xl font-bold mb-1">Stop guessing, start discovering</h3>
                <p class="text-sm md:text-base text-gray-200">Identify the AI use cases that matter most for your business.</p>
            </div>
            <a href="http://assessment.o3world.com/" target="_blank" rel="noopener noreferrer" aria-label="Take the AI assessment to identify use cases for your business" class="bg-white text-gray-900 px-6 py-3 rounded-lg font-semibold whitespace-nowrap focus:outline-none inline-flex items-center justify-center gap-2 btn-press hover-lift transition-smooth focus-ring shadow-lg hover:shadow-xl">
                Take the AI assessment
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14"></path>
                    <path d="m12 5 7 7-7 7"></path>
                </svg>
            </a>
        </div>
    </div>
</aside>

<script>
(function() {
    'use strict';

    const cta = document.querySelector('[data-sticky-cta]');
    const dismissBtn = document.querySelector('[data-dismiss-cta]');

    if (!cta) return;

    // Check if user has dismissed the CTA in this session
    const isDismissed = sessionStorage.getItem('ctaDismissed') === 'true';
    if (isDismissed) {
        cta.remove();
        return;
    }

    let hasShown = false;
    let isVisible = false;

    // Get CTA height and add padding to body
    const updateBodyPadding = () => {
        const ctaHeight = cta.offsetHeight;
        document.body.style.paddingBottom = `${ctaHeight}px`;
    };

    // Show/hide CTA based on scroll position
    const showCTA = () => {
        if (hasShown) return;
        hasShown = true;
        isVisible = true;
        updateBodyPadding();
    };

    const hideCTA = () => {
        if (!isVisible) return;
        isVisible = false;
        cta.style.transform = 'translateY(100%)';
        document.body.style.paddingBottom = '0';
    };

    const revealCTA = () => {
        if (isVisible) return;
        isVisible = true;
        cta.style.transform = 'translateY(0)';
        updateBodyPadding();
    };

    // Check if user is near bottom of page (within 200px of footer)
    const checkScrollPosition = () => {
        const scrollPosition = window.scrollY + window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;
        const distanceFromBottom = documentHeight - scrollPosition;

        // Hide CTA when within 200px of bottom to reveal footer
        if (distanceFromBottom < 200) {
            hideCTA();
        } else if (hasShown) {
            revealCTA();
        }
    };

    // Initial show trigger
    const handleInitialScroll = () => {
        if (window.scrollY > 300) {
            showCTA();
            window.removeEventListener('scroll', handleInitialScroll);
            window.addEventListener('scroll', checkScrollPosition, { passive: true });
            checkScrollPosition(); // Check immediately after showing
        }
    };

    window.addEventListener('scroll', handleInitialScroll, { passive: true });

    // Also show after 3 seconds if not already shown
    setTimeout(() => {
        if (!hasShown) {
            showCTA();
            window.removeEventListener('scroll', handleInitialScroll);
            window.addEventListener('scroll', checkScrollPosition, { passive: true });
        }
    }, 3000);

    // Update padding on window resize
    window.addEventListener('resize', () => {
        if (hasShown && isVisible && cta.offsetHeight) {
            updateBodyPadding();
        }
    }, { passive: true });

    // Dismiss functionality
    if (dismissBtn) {
        dismissBtn.addEventListener('click', () => {
            cta.style.transform = 'translateY(100%)';
            sessionStorage.setItem('ctaDismissed', 'true');
            setTimeout(() => {
                document.body.style.paddingBottom = '0';
                cta.remove();
                window.removeEventListener('scroll', checkScrollPosition);
            }, 500);
        });
    }
})();
</script>
